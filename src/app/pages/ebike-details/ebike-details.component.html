<ng-container *transloco="let t; lang: lang; prefix: 'pages.ebike-details'">
  <div class="container flex-container-vertical">
    @if (authenticationService.isLoggedIn()) {
      <div class="inner-container">
        <h2>
          <span class="material-symbols-outlined ebike icon">
            electric_bike
          </span>
          {{ t("title") }}
          {{ ebikeProfile()?.id }}
          <span class="delimiter">·</span>
          <button mat-button routerLink="/ebikes" queryParamsHandling="merge">
            {{ t("actions.show-all") }}
          </button>
        </h2>

        @if (isEbikeRegistered(ebikeProfile()?.id)) {
          <ul class="list">
            <li>
              <span class="material-symbols-outlined ebike-registered icon">
                verified
              </span>
              <strong class="ebike-registered">{{
                t("terms.registered")
              }}</strong>
            </li>
          </ul>
        }

        <ul class="list">
          <li>
            <strong class="label">{{ t("terms.oem-id") }}</strong
            >:
            @if (ebikeProfile()?.oemId) {
              {{ ebikeProfile()?.oemId }}
            } @else {
              <em>{{ t("terms.undefined") }}</em>
            }
          </li>
          <li>
            <strong class="label">{{ t("terms.created-at") }}</strong
            >:
            @if (ebikeProfile()?.createdAt) {
              {{ ebikeProfile()?.createdAt | date: "medium" }}
            } @else {
              <em>{{ t("terms.undefined") }}</em>
            }
          </li>
          <li>
            <strong class="label">{{ t("terms.language") }}</strong
            >:
            @if (ebikeProfile()?.language) {
              {{ ebikeProfile()?.language }}
            } @else {
              <em>{{ t("terms.undefined") }}</em>
            }
          </li>
        </ul>

        <ul class="list">
          <li>
            <strong class="label">{{ t("terms.service-due-date") }}</strong
            >:
            @if (ebikeProfile()?.serviceDue?.date) {
              {{ ebikeProfile()?.serviceDue?.date | date: "medium" }}
            } @else {
              <em>{{ t("terms.undefined") }}</em>
            }
          </li>
          <li>
            <strong class="label">{{ t("terms.service-due-odometer") }}</strong
            >:
            @if (ebikeProfile()?.serviceDue?.odometer) {
              {{ ebikeProfile()?.serviceDue?.odometer }}
            } @else {
              <em>{{ t("terms.undefined") }}</em>
            }
          </li>
        </ul>

        <h3>{{ t("terms.components") }}</h3>

        <div class="grid">
          @if (ebikeProfile()?.driveUnit) {
            <mat-card
              mat-ripple
              [routerLink]="['/component-details', ebikeProfile()?.id]"
              [queryParams]="{
                serialNumber: ebikeProfile()?.driveUnit?.serialNumber,
                partNumber: ebikeProfile()?.driveUnit?.partNumber,
              }"
              queryParamsHandling="merge"
            >
              <mat-card-header>
                <div mat-card-avatar>
                  <span class="material-symbols-outlined component icon">
                    extension
                  </span>
                </div>
                <mat-card-title
                  >{{ ebikeProfile()?.driveUnit?.productName }}
                </mat-card-title>
                <mat-card-subtitle>
                  @if (
                    isComponentRegistered(
                      ebikeProfile()?.driveUnit?.partNumber,
                      ebikeProfile()?.driveUnit?.serialNumber
                    )
                  ) {
                    <span
                      class="material-symbols-outlined component-registered icon"
                    >
                      verified
                    </span>
                    <span class="component-registered">{{
                      t("terms.registered")
                    }}</span>
                    <span class="delimiter">·</span>
                  }
                  {{ t("terms.drive-unit") }}
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <ul class="list">
                  <li>
                    <strong class="label">{{ t("terms.serial-number") }}</strong
                    >: {{ ebikeProfile()?.driveUnit?.serialNumber }}
                  </li>
                  <li>
                    <strong class="label">{{ t("terms.part-number") }}</strong
                    >: {{ ebikeProfile()?.driveUnit?.partNumber }}
                  </li>
                </ul>
              </mat-card-content>
              <mat-card-actions></mat-card-actions>
            </mat-card>
          }

          @if (ebikeProfile()?.remoteControl) {
            <mat-card
              mat-ripple
              [routerLink]="['/component-details', ebikeProfile()?.id]"
              [queryParams]="{
                serialNumber: ebikeProfile()?.remoteControl?.serialNumber,
                partNumber: ebikeProfile()?.remoteControl?.partNumber,
              }"
              queryParamsHandling="merge"
            >
              <mat-card-header>
                <div mat-card-avatar>
                  <span class="material-symbols-outlined component icon">
                    extension
                  </span>
                </div>
                <mat-card-title
                  >{{ ebikeProfile()?.remoteControl?.productName }}
                </mat-card-title>
                <mat-card-subtitle
                  >{{ t("terms.remote-control") }}
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <ul class="list">
                  <li>
                    <strong class="label">{{ t("terms.serial-number") }}</strong
                    >: {{ ebikeProfile()?.remoteControl?.serialNumber }}
                  </li>
                  <li>
                    <strong class="label">{{ t("terms.part-number") }}</strong
                    >: {{ ebikeProfile()?.remoteControl?.partNumber }}
                  </li>
                </ul>
              </mat-card-content>
              <mat-card-actions></mat-card-actions>
            </mat-card>
          }

          @for (battery of ebikeProfile()?.batteries; track battery) {
            <mat-card
              mat-ripple
              [routerLink]="['/component-details', ebikeProfile()?.id]"
              [queryParams]="{
                serialNumber: battery.serialNumber,
                partNumber: battery.partNumber,
              }"
              queryParamsHandling="merge"
            >
              <mat-card-header>
                <div mat-card-avatar>
                  <span class="material-symbols-outlined component icon">
                    battery_charging_full
                  </span>
                </div>
                <mat-card-title>{{ battery.productName }}</mat-card-title>
                <mat-card-subtitle>{{ t("terms.battery") }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <ul class="list">
                  <li>
                    <strong class="label">{{ t("terms.serial-number") }}</strong
                    >: {{ battery.serialNumber }}
                  </li>
                  <li>
                    <strong class="label">{{ t("terms.part-number") }}</strong
                    >: {{ battery.partNumber }}
                  </li>
                </ul>
              </mat-card-content>
              <mat-card-actions></mat-card-actions>
            </mat-card>
          }

          @for (
            antiLockBrakeSystem of ebikeProfile()?.antiLockBrakeSystems;
            track antiLockBrakeSystem
          ) {
            <mat-card
              mat-ripple
              [routerLink]="['/component-details', ebikeProfile()?.id]"
              [queryParams]="{
                serialNumber: antiLockBrakeSystem.serialNumber,
                partNumber: antiLockBrakeSystem.partNumber,
              }"
              queryParamsHandling="merge"
            >
              <mat-card-header>
                <div mat-card-avatar>
                  <span class="material-symbols-outlined component icon">
                    extension
                  </span>
                </div>
                <mat-card-title
                  >{{ antiLockBrakeSystem.productName }}
                </mat-card-title>
                <mat-card-subtitle
                  >{{ t("terms.anti-lock-brake-system") }}
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <ul class="list">
                  <li>
                    <strong class="label">{{ t("terms.serial-number") }}</strong
                    >: {{ antiLockBrakeSystem.serialNumber }}
                  </li>
                  <li>
                    <strong class="label">{{ t("terms.part-number") }}</strong
                    >: {{ antiLockBrakeSystem.partNumber }}
                  </li>
                </ul>
              </mat-card-content>
              <mat-card-actions></mat-card-actions>
            </mat-card>
          }

          @if (ebikeProfile()?.connectModule) {
            <mat-card
              mat-ripple
              [routerLink]="['/component-details', ebikeProfile()?.id]"
              [queryParams]="{
                serialNumber: ebikeProfile()?.connectModule?.serialNumber,
                partNumber: ebikeProfile()?.connectModule?.partNumber,
              }"
              queryParamsHandling="merge"
            >
              <mat-card-header>
                <div mat-card-avatar>
                  <span class="material-symbols-outlined component icon">
                    extension
                  </span>
                </div>
                <mat-card-title
                  >{{ ebikeProfile()?.connectModule?.productName }}
                </mat-card-title>
                <mat-card-subtitle
                  >{{ t("terms.connect-module") }}
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <ul class="list">
                  <li>
                    <strong class="label">{{ t("terms.serial-number") }}</strong
                    >: {{ ebikeProfile()?.connectModule?.serialNumber }}
                  </li>
                  <li>
                    <strong class="label">{{ t("terms.part-number") }}</strong
                    >: {{ ebikeProfile()?.connectModule?.partNumber }}
                  </li>
                </ul>
              </mat-card-content>
              <mat-card-actions></mat-card-actions>
            </mat-card>
          }

          @if (ebikeProfile()?.headUnit) {
            <mat-card
              mat-ripple
              [routerLink]="['/component-details', ebikeProfile()?.id]"
              [queryParams]="{
                serialNumber: ebikeProfile()?.headUnit?.serialNumber,
                partNumber: ebikeProfile()?.headUnit?.partNumber,
              }"
              queryParamsHandling="merge"
            >
              <mat-card-header>
                <div mat-card-avatar>
                  <span class="material-symbols-outlined component icon">
                    tablet
                  </span>
                </div>
                <mat-card-title
                  >{{ ebikeProfile()?.headUnit?.productName }}
                </mat-card-title>
                <mat-card-subtitle
                  >{{ t("terms.head-unit") }}
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <ul class="list">
                  <li>
                    <strong class="label">{{ t("terms.serial-number") }}</strong
                    >: {{ ebikeProfile()?.headUnit?.serialNumber }}
                  </li>
                  <li>
                    <strong class="label">{{ t("terms.part-number") }}</strong
                    >: {{ ebikeProfile()?.headUnit?.partNumber }}
                  </li>
                </ul>
              </mat-card-content>
              <mat-card-actions></mat-card-actions>
            </mat-card>
          }
        </div>

        <h3>{{ t("terms.bike-passes") }}</h3>

        @for (bikePass of bikePasses(); track bikePass) {
          <mat-card mat-ripple>
            <mat-card-header>
              <div mat-card-avatar>
                <span class="material-symbols-outlined bike-pass icon">
                  badge
                </span>
              </div>
              <mat-card-title>{{ t("terms.bike-pass") }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <ul class="list">
                <li>
                  <strong class="label">{{ t("terms.frame-number") }}</strong
                  >: {{ bikePass.frameNumber }}
                </li>
                <li>
                  <strong class="label">{{
                    t("terms.frame-number-position")
                  }}</strong
                  >: {{ bikePass.frameNumberPosition }}
                </li>
                <li>
                  <strong class="label">{{ t("terms.description") }}</strong
                  >: {{ bikePass.description }}
                </li>
                <li>
                  <strong class="label">{{ t("terms.created-at") }}</strong
                  >: {{ bikePass.createdAt }}
                </li>
                <li>
                  <strong class="label">{{ t("terms.updated-at") }}</strong
                  >: {{ bikePass.updatedAt }}
                </li>
              </ul>
            </mat-card-content>
            <mat-card-actions></mat-card-actions>
            <mat-card-footer></mat-card-footer>
          </mat-card>
        } @empty {
          <p>{{ t("messages.no-bike-passes") }}</p>
        }

        <h3>{{ t("terms.bulk-installation-reports") }}</h3>

        @for (
          installationReport of bulkInstallationReports();
          track installationReport
        ) {
          <mat-card>
            <mat-card-header>
              <div mat-card-avatar>
                <span
                  class="material-symbols-outlined installation-report icon"
                >
                  assignment
                </span>
              </div>
              <mat-card-title
                >{{ t("terms.bulk-installation-report") }}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <app-attribute-tree
                [object]="installationReport"
              ></app-attribute-tree>
            </mat-card-content>
          </mat-card>
        } @empty {
          <p>{{ t("messages.no-bulk-installation-reports") }}</p>
        }

        <h3>{{ t("terms.service-book") }}</h3>

        @for (serviceRecord of serviceRecords(); track serviceRecord) {
          <mat-card class="service-record-card">
            <mat-card-header>
              <div mat-card-avatar>
                <span class="material-symbols-outlined service-record icon">
                  assignment
                </span>
              </div>
              <mat-card-title>{{ t("terms.service-record") }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <app-attribute-tree [object]="serviceRecord"></app-attribute-tree>
            </mat-card-content>
          </mat-card>
        } @empty {
          <p>{{ t("messages.no-service-records") }}</p>
        }

        <h3>{{ t("terms.remote-configuration-cases") }}</h3>

        @for (
          remoteConfigurationCase of remoteConfigurationCases();
          track remoteConfigurationCase
        ) {
          <mat-card>
            <mat-card-header>
              <div mat-card-avatar>
                <span
                  class="material-symbols-outlined remote-configuration-case icon"
                >
                  assignment
                </span>
              </div>
              <mat-card-title
                >{{ t("terms.remote-configuration-case") }}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <app-attribute-tree
                [object]="remoteConfigurationCase"
              ></app-attribute-tree>
            </mat-card-content>
          </mat-card>
        } @empty {
          <p>{{ t("messages.no-remote-configuration-cases") }}</p>
        }

        <h3>{{ t("terms.installation-reports") }}</h3>

        @for (
          installationReport of installationReports();
          track installationReport
        ) {
          <mat-card>
            <mat-card-header>
              <div mat-card-avatar>
                <span
                  class="material-symbols-outlined installation-report icon"
                >
                  assignment
                </span>
              </div>
              <mat-card-title
                >{{ t("terms.installation-report") }}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <app-attribute-tree
                [object]="installationReport"
              ></app-attribute-tree>
            </mat-card-content>
          </mat-card>
        } @empty {
          <p>{{ t("messages.no-installation-reports") }}</p>
        }
      </div>
      <div class="flex-box"></div>
    }
  </div>
</ng-container>
